<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log Simultaneous Equations</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <script type="module">import 'https://unpkg.com/mathlive?module';</script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary: #4361ee;
            --primary-light: #eef0ff;
            --success: #06d6a0;
            --success-light: #e6faf4;
            --error: #ef476f;
            --error-light: #fde8ed;
            --bg: #f0f2f5;
            --card: #ffffff;
            --text: #2b2d42;
            --text-light: #6c757d;
            --radius: 16px;
            --shadow: 0 4px 24px rgba(0,0,0,0.08);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg); color: var(--text);
            min-height: 100vh; padding: 20px;
        }
        #app { max-width: 680px; margin: 0 auto; }

        .nav {
            display: flex; justify-content: center; gap: 8px;
            margin-bottom: 20px; flex-wrap: wrap;
        }
        .nav a {
            text-decoration: none; font-size: 0.85rem; font-weight: 600;
            padding: 6px 16px; border-radius: 20px; transition: all 0.2s;
        }
        .nav a.active { background: var(--primary); color: #fff; }
        .nav a:not(.active) {
            background: var(--card); color: var(--primary); box-shadow: var(--shadow);
        }
        .nav a:not(.active):hover { background: var(--primary-light); }

        header { text-align: center; margin-bottom: 24px; }
        header h1 { font-size: 1.8rem; font-weight: 700; color: var(--primary); margin-bottom: 4px; }
        header p  { color: var(--text-light); font-size: 0.95rem; }

        .score-bar {
            display: flex; justify-content: center; gap: 16px;
            margin-bottom: 24px; flex-wrap: wrap;
        }
        .score-item {
            background: var(--card); padding: 10px 20px; border-radius: 12px;
            box-shadow: var(--shadow); text-align: center; min-width: 90px;
        }
        .score-item .label {
            font-size: 0.7rem; text-transform: uppercase;
            letter-spacing: 0.05em; color: var(--text-light); margin-bottom: 2px;
        }
        .score-item .value { font-size: 1.3rem; font-weight: 700; }
        .score-item .value.primary { color: var(--primary); }
        .score-item .value.success { color: var(--success); }

        .question-card {
            background: var(--card); border-radius: var(--radius);
            box-shadow: var(--shadow); padding: 32px; margin-bottom: 20px;
            text-align: center;
        }
        .difficulty-tag {
            display: inline-block; font-size: 0.78rem; font-weight: 600;
            padding: 4px 14px; border-radius: 20px; margin-bottom: 14px;
        }
        .difficulty-tag.easy   { background: var(--success-light); color: #047857; }
        .difficulty-tag.medium { background: #fff3cd; color: #856404; }
        .difficulty-tag.hard   { background: var(--error-light); color: #be123c; }
        .equation-system { font-size: 1.35rem; line-height: 2.6; margin: 16px 0; }

        .workout-section {
            background: var(--card); border-radius: var(--radius);
            box-shadow: var(--shadow); padding: 24px; margin-bottom: 20px;
        }
        .workout-section h3 {
            font-size: 0.9rem; font-weight: 600; color: var(--primary);
            margin-bottom: 12px;
        }
        .workout-textarea {
            width: 100%; min-height: 180px; padding: 16px;
            border: 2px solid #e0e0e0; border-radius: 12px;
            font-family: 'Cascadia Code', 'Fira Code', 'SF Mono', 'Consolas', monospace;
            font-size: 1rem; line-height: 1.8; color: var(--text);
            resize: vertical; background: #fafbfc; transition: border-color 0.2s;
        }
        .workout-textarea:focus {
            border-color: var(--primary); outline: none;
            box-shadow: 0 0 0 3px rgba(67,97,238,0.15);
        }
        .workout-textarea::placeholder { color: #b0b8c4; }

        .answer-section {
            background: var(--card); border-radius: var(--radius);
            box-shadow: var(--shadow); padding: 24px; margin-bottom: 20px;
            text-align: center;
        }
        .answer-section h3 {
            font-size: 0.9rem; font-weight: 600; color: var(--primary);
            margin-bottom: 16px;
        }
        .answer-row {
            display: flex; justify-content: center; align-items: center;
            gap: 12px; margin-bottom: 12px; flex-wrap: wrap;
        }
        .answer-label {
            font-size: 1.3rem; font-weight: 600; min-width: 30px; text-align: right;
        }
        math-field {
            font-size: 1.4rem; width: 140px; border-radius: 12px;
            border: 2px solid #e0e0e0; padding: 8px 14px;
            --caret-color: var(--primary);
            --selection-background-color: rgba(67,97,238,0.18);
        }
        math-field:focus-within {
            border-color: var(--primary); outline: none;
            box-shadow: 0 0 0 3px rgba(67,97,238,0.15);
        }

        .btn {
            border: none; border-radius: 12px; padding: 12px 32px;
            font-size: 1rem; font-weight: 600; cursor: pointer;
            transition: all 0.2s ease; font-family: inherit;
        }
        .btn-primary { background: var(--primary); color: #fff; }
        .btn-primary:hover { background: #3651d4; transform: translateY(-2px); }
        .btn:disabled { background: #ccc; cursor: default; transform: none; }
        .btn-row { margin-top: 16px; }

        .feedback {
            border-radius: var(--radius); padding: 20px 24px; margin-bottom: 20px;
            display: none; text-align: left; animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to   { opacity: 1; transform: translateY(0); }
        }
        .feedback.show { display: block; }
        .feedback.correct  { background: var(--success-light); border: 2px solid var(--success); color: #047857; }
        .feedback.incorrect { background: var(--error-light); border: 2px solid var(--error); color: #be123c; }
        .feedback-title { font-weight: 700; font-size: 1.1rem; margin-bottom: 10px; text-align: center; }
        .feedback-explanation { font-size: 0.95rem; line-height: 2; }
        .solution-step { margin: 4px 0; }

        #next-btn { display: none; margin: 0 auto 24px; }

        .rules-ref {
            background: var(--card); border-radius: var(--radius);
            box-shadow: var(--shadow); margin-top: 8px;
        }
        .rules-ref summary {
            padding: 16px 24px; cursor: pointer; font-weight: 600;
            color: var(--primary); user-select: none; list-style: none;
        }
        .rules-ref summary::-webkit-details-marker { display: none; }
        .rules-ref summary::before { content: '+ '; font-weight: 700; }
        .rules-ref[open] summary::before { content: '- '; }
        .rules-content { padding: 0 24px 20px; }
        .rule-item {
            padding: 10px 0; border-bottom: 1px solid #f0f0f0;
            font-size: 0.95rem; line-height: 2;
        }
        .rule-item:last-child { border-bottom: none; }
        .rule-name {
            font-weight: 600; color: var(--primary); display: block;
            margin-bottom: 2px; font-size: 0.82rem;
        }

        @media (max-width: 480px) {
            .question-card { padding: 24px 16px; }
            .equation-system { font-size: 1.1rem; }
            math-field { width: 120px; font-size: 1.2rem; }
            .workout-textarea { min-height: 140px; font-size: 0.9rem; }
        }
    </style>
</head>
<body>
<div id="app">
    <nav class="nav">
        <a href="index.html">Log Rules</a>
        <a href="simultaneous.html" class="active">Log Simultaneous Equations</a>
    </nav>

    <header>
        <h1>Log Simultaneous Equations</h1>
        <p>IB MYP Level &mdash; Solve systems using logarithm rules</p>
    </header>

    <div class="score-bar">
        <div class="score-item">
            <div class="label">Score</div>
            <div class="value primary" id="score-display">0 / 0</div>
        </div>
        <div class="score-item">
            <div class="label">Accuracy</div>
            <div class="value primary" id="pct-display">&mdash;</div>
        </div>
        <div class="score-item">
            <div class="label">Streak</div>
            <div class="value success" id="streak-display">0</div>
        </div>
    </div>

    <div class="question-card" id="question-card">
        <p style="color:var(--text-light)">Loading&hellip;</p>
    </div>

    <div class="workout-section">
        <h3>Your Working</h3>
        <textarea class="workout-textarea" id="workout"
            placeholder="Show your working here...&#10;&#10;e.g.  Let u = log₂(x), v = log₂(y)&#10;      u + v = 5&#10;      u - v = 1&#10;      Add: 2u = 6, u = 3&#10;      So x = 2³ = 8"></textarea>
    </div>

    <div class="answer-section">
        <h3>Your Answer</h3>
        <div class="answer-row">
            <span class="answer-label">\(x =\)</span>
            <math-field id="mf-x" placeholder="?"></math-field>
        </div>
        <div class="answer-row">
            <span class="answer-label">\(y =\)</span>
            <math-field id="mf-y" placeholder="?"></math-field>
        </div>
        <div class="btn-row">
            <button class="btn btn-primary" id="check-btn">Check Answer</button>
        </div>
    </div>

    <div class="feedback" id="feedback">
        <div class="feedback-title" id="feedback-title"></div>
        <div class="feedback-explanation" id="feedback-explanation"></div>
    </div>

    <button class="btn btn-primary" id="next-btn">Next Question</button>

    <details class="rules-ref">
        <summary>Reference</summary>
        <div class="rules-content" id="rules-content"></div>
    </details>
</div>

<script>
/* ================================================================
   LOG SIMULTANEOUS EQUATIONS TRAINER  –  IB MYP
   ================================================================ */

function randInt(a, b) { return Math.floor(Math.random() * (b - a + 1)) + a; }
function pick(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

function renderMath() {
    if (typeof renderMathInElement === 'function') {
        renderMathInElement(document.body, {
            delimiters: [
                { left: '\\(', right: '\\)', display: false },
                { left: '$$',  right: '$$',  display: true  }
            ],
            throwOnError: false
        });
    }
}

let score = 0, total = 0, streak = 0, currentQ = null, answered = false;
const BASES = [2, 3, 5, 10];

function logTex(b, arg) { return `\\log_{${b}}(${arg})`; }

// ── Question Generators ──────────────────────────────────────────

// Type 1 – Easy: Direct log equations
// log_b(x) = u,  log_b(y) = v  →  x = b^u, y = b^v
function qDirect() {
    const b = pick(BASES);
    const u = randInt(1, 4), v = randInt(1, 4);
    if (u === v) return qDirect();
    const x = Math.pow(b, u), y = Math.pow(b, v);
    if (x > 10000 || y > 10000) return qDirect();

    const steps = [
        `\\text{From Eq1: } ${logTex(b,'x')} = ${u} \\implies x = ${b}^{${u}} = ${x}`,
        `\\text{From Eq2: } ${logTex(b,'y')} = ${v} \\implies y = ${b}^{${v}} = ${y}`,
        `\\boxed{x = ${x},\\quad y = ${y}}`
    ];

    return {
        difficulty: 'easy', x, y,
        eq1: `${logTex(b,'x')} = ${u}`,
        eq2: `${logTex(b,'y')} = ${v}`,
        solution: steps
    };
}

// Type 2 – Medium: Sum & difference of logs
// log_b(x) + log_b(y) = p,  log_b(x) - log_b(y) = q
function qSumDiff() {
    const b = pick(BASES);
    const u = randInt(1, 4), v = randInt(1, 4);
    if (u === v) return qSumDiff();
    const x = Math.pow(b, u), y = Math.pow(b, v);
    if (x > 10000 || y > 10000) return qSumDiff();
    const p = u + v, q = u - v;

    const steps = [
        `\\text{Let } u = ${logTex(b,'x')},\\; v = ${logTex(b,'y')}`,
        `\\text{Eq1: } u + v = ${p}`,
        `\\text{Eq2: } u - v = ${q}`,
        `\\text{Add: } 2u = ${p + q} \\implies u = ${u}`,
        `\\text{Substitute: } ${u} + v = ${p} \\implies v = ${v}`,
        `x = ${b}^{${u}} = ${x},\\quad y = ${b}^{${v}} = ${y}`,
        `\\boxed{x = ${x},\\quad y = ${y}}`
    ];

    return {
        difficulty: 'medium', x, y,
        eq1: `${logTex(b,'x')} + ${logTex(b,'y')} = ${p}`,
        eq2: `${logTex(b,'x')} - ${logTex(b,'y')} = ${q}`,
        solution: steps
    };
}

// Type 3 – Medium: Product & quotient form (needs log rules first)
// log_b(xy) = p,  log_b(x/y) = q
function qProdQuot() {
    const b = pick(BASES);
    const u = randInt(1, 4), v = randInt(1, 4);
    if (u === v) return qProdQuot();
    const x = Math.pow(b, u), y = Math.pow(b, v);
    if (x > 10000 || y > 10000) return qProdQuot();
    const p = u + v, q = u - v;

    const steps = [
        `\\text{Apply Product Rule to Eq1: } ${logTex(b,'x')} + ${logTex(b,'y')} = ${p}`,
        `\\text{Apply Quotient Rule to Eq2: } ${logTex(b,'x')} - ${logTex(b,'y')} = ${q}`,
        `\\text{Let } u = ${logTex(b,'x')},\\; v = ${logTex(b,'y')}`,
        `u + v = ${p},\\quad u - v = ${q}`,
        `\\text{Add: } 2u = ${p + q} \\implies u = ${u}`,
        `\\text{Substitute: } v = ${p} - ${u} = ${v}`,
        `x = ${b}^{${u}} = ${x},\\quad y = ${b}^{${v}} = ${y}`,
        `\\boxed{x = ${x},\\quad y = ${y}}`
    ];

    return {
        difficulty: 'medium', x, y,
        eq1: `${logTex(b,'xy')} = ${p}`,
        eq2: `${logTex(b, '\\tfrac{x}{y}')} = ${q}`,
        solution: steps
    };
}

// Type 4 – Hard: Coefficients requiring power rule
// a1·log_b(x) + b1·log_b(y) = p,  a2·log_b(x) + b2·log_b(y) = q
function qCoefficients() {
    const b = pick(BASES);
    const u = randInt(1, 3), v = randInt(1, 3);
    const x = Math.pow(b, u), y = Math.pow(b, v);
    if (x > 10000 || y > 10000) return qCoefficients();

    // Pick small coefficients for the system
    const a1 = randInt(1, 3), b1 = randInt(1, 3);
    const a2 = randInt(1, 3), b2 = randInt(1, 3);
    const det = a1 * b2 - a2 * b1;
    if (det === 0) return qCoefficients();
    // Avoid trivially same rows
    if (a1 === a2 && b1 === b2) return qCoefficients();

    const p = a1 * u + b1 * v;
    const q = a2 * u + b2 * v;

    // Build worked solution using elimination
    const steps = [];
    steps.push(`\\text{Let } u = ${logTex(b,'x')},\\; v = ${logTex(b,'y')}`);

    function coeffTerm(c, variable, first) {
        if (c === 1) return first ? variable : ' + ' + variable;
        if (c === -1) return first ? '-' + variable : ' - ' + variable;
        if (c > 0) return first ? c + variable : ' + ' + c + variable;
        return ' - ' + Math.abs(c) + variable;
    }

    const eq1Str = coeffTerm(a1,'u',true) + coeffTerm(b1,'v',false) + ' = ' + p;
    const eq2Str = coeffTerm(a2,'u',true) + coeffTerm(b2,'v',false) + ' = ' + q;
    steps.push(`\\text{Eq1: } ${eq1Str}`);
    steps.push(`\\text{Eq2: } ${eq2Str}`);

    // Eliminate u: multiply eq1 by a2, eq2 by a1
    const m1 = a2, m2 = a1;
    const nb1 = b1 * m1, nc1 = p * m1;
    const nb2 = b2 * m2, nc2 = q * m2;

    if (m1 !== 1) steps.push(`\\text{Eq1} \\times ${m1}: \\quad ${coeffTerm(a1*m1,'u',true)}${coeffTerm(nb1,'v',false)} = ${nc1}`);
    if (m2 !== 1) steps.push(`\\text{Eq2} \\times ${m2}: \\quad ${coeffTerm(a2*m2,'u',true)}${coeffTerm(nb2,'v',false)} = ${nc2}`);

    const diffB = nb1 - nb2;
    const diffC = nc1 - nc2;
    steps.push(`\\text{Subtract: } ${coeffTerm(diffB,'v',true)} = ${diffC}`);
    steps.push(`v = ${diffC} \\div ${diffB} = ${v}`);
    steps.push(`\\text{Substitute back: } u = \\frac{${p} - ${b1 === 1 ? '' : b1}\\cdot${v}}{${a1}} = ${u}`);
    steps.push(`x = ${b}^{${u}} = ${x},\\quad y = ${b}^{${v}} = ${y}`);
    steps.push(`\\boxed{x = ${x},\\quad y = ${y}}`);

    // Build equation display with log notation
    function logEqTex(ca, cb, rhs) {
        let s = '';
        if (ca === 1) s = logTex(b,'x');
        else s = ca + '\\,' + logTex(b,'x');
        if (cb === 1) s += ' + ' + logTex(b,'y');
        else if (cb === -1) s += ' - ' + logTex(b,'y');
        else if (cb > 0) s += ' + ' + cb + '\\,' + logTex(b,'y');
        else s += ' - ' + Math.abs(cb) + '\\,' + logTex(b,'y');
        return s + ' = ' + rhs;
    }

    return {
        difficulty: 'hard', x, y,
        eq1: logEqTex(a1, b1, p),
        eq2: logEqTex(a2, b2, q),
        solution: steps
    };
}

// Type 5 – Hard: Power form (needs power rule to unpack)
// log_b(x^a · y^c) = p,  log_b(x^d · y^f) = q
function qPowerForm() {
    const b = pick(BASES);
    const u = randInt(1, 3), v = randInt(1, 3);
    const x = Math.pow(b, u), y = Math.pow(b, v);
    if (x > 10000 || y > 10000) return qPowerForm();

    const a1 = randInt(2, 3), b1 = 1;
    const a2 = 1, b2 = randInt(2, 3);
    const det = a1 * b2 - a2 * b1;
    if (det === 0) return qPowerForm();

    const p = a1 * u + b1 * v;
    const q = a2 * u + b2 * v;

    // Build the "inside the log" expressions
    function insideTex(ca, cb) {
        let s = ca > 1 ? `x^{${ca}}` : 'x';
        s += cb > 1 ? `y^{${cb}}` : 'y';
        return s;
    }

    const steps = [
        `\\text{Apply Product \\& Power Rules:}`,
        `\\text{Eq1: } ${a1 > 1 ? a1+'\\,' : ''}${logTex(b,'x')} + ${b1 > 1 ? b1+'\\,' : ''}${logTex(b,'y')} = ${p}`,
        `\\text{Eq2: } ${a2 > 1 ? a2+'\\,' : ''}${logTex(b,'x')} + ${b2 > 1 ? b2+'\\,' : ''}${logTex(b,'y')} = ${q}`,
        `\\text{Let } u = ${logTex(b,'x')},\\; v = ${logTex(b,'y')}`
    ];

    // Solve: a1*u + b1*v = p, a2*u + b2*v = q
    // Multiply eq2 by a1: a1*u + a1*b2*v = a1*q
    // Subtract eq1: (a1*b2 - b1)*v = a1*q - p
    const vCoeff = a1 * b2 - b1;
    const vRhs = a1 * q - p;
    steps.push(`\\text{Eq2} \\times ${a1}: \\quad ${a1}u + ${a1*b2}v = ${a1*q}`);
    steps.push(`\\text{Subtract Eq1: } ${vCoeff}v = ${vRhs} \\implies v = ${v}`);
    steps.push(`\\text{Substitute: } u = ${q} - ${b2 > 1 ? b2+'\\cdot' : ''}${v} = ${u}`);
    steps.push(`x = ${b}^{${u}} = ${x},\\quad y = ${b}^{${v}} = ${y}`);
    steps.push(`\\boxed{x = ${x},\\quad y = ${y}}`);

    return {
        difficulty: 'hard', x, y,
        eq1: `${logTex(b, insideTex(a1, b1))} = ${p}`,
        eq2: `${logTex(b, insideTex(a2, b2))} = ${q}`,
        solution: steps
    };
}

// Weighted pool
const pool = [
    qDirect, qDirect,
    qSumDiff, qSumDiff, qSumDiff,
    qProdQuot, qProdQuot,
    qCoefficients,
    qPowerForm
];

function nextQuestion() { return pick(pool)(); }

// ── Answer Parsing ───────────────────────────────────────────────
function parseLatex(raw) {
    let s = raw.replace(/\\left|\\right|\\,|\\:|\\;|\\!/g, '').replace(/\s+/g, '');
    s = s.replace(/^−/, '-'); // unicode minus
    const fm = s.match(/\\frac\{(-?[\d.]+)\}\{(-?[\d.]+)\}/);
    if (fm) return parseFloat(fm[1]) / parseFloat(fm[2]);
    const dm = s.match(/\\dfrac\{(-?[\d.]+)\}\{(-?[\d.]+)\}/);
    if (dm) return parseFloat(dm[1]) / parseFloat(dm[2]);
    const dv = s.match(/^(-?[\d.]+)\/(-?[\d.]+)$/);
    if (dv) return parseFloat(dv[1]) / parseFloat(dv[2]);
    return parseFloat(s);
}

function checkAnswer(lx, ly, ex, ey) {
    const ux = parseLatex(lx), uy = parseLatex(ly);
    if (isNaN(ux) || isNaN(uy)) return false;
    return Math.abs(ux - ex) < 0.001 && Math.abs(uy - ey) < 0.001;
}

// ── UI ───────────────────────────────────────────────────────────
function loadQuestion() {
    answered = false;
    currentQ = nextQuestion();
    const q = currentQ;

    const diffLabel = { easy: 'Easy', medium: 'Medium', hard: 'Challenging' };
    document.getElementById('question-card').innerHTML = `
        <div class="difficulty-tag ${q.difficulty}">${diffLabel[q.difficulty]}</div>
        <div style="font-size:1.1rem;margin-bottom:8px;">Find \\(x\\) and \\(y\\):</div>
        <div class="equation-system">
            \\(${q.eq1}\\)<br>
            \\(${q.eq2}\\)
        </div>`;

    document.getElementById('workout').value = '';
    const mfx = document.getElementById('mf-x');
    const mfy = document.getElementById('mf-y');
    if (mfx) { mfx.value = ''; mfx.disabled = false; }
    if (mfy) { mfy.value = ''; mfy.disabled = false; }
    document.getElementById('check-btn').disabled = false;

    const fb = document.getElementById('feedback');
    fb.classList.remove('show', 'correct', 'incorrect');
    document.getElementById('next-btn').style.display = 'none';

    renderMath();
}

function handleCheck() {
    if (answered) return;
    const mfx = document.getElementById('mf-x');
    const mfy = document.getElementById('mf-y');
    if (!mfx || !mfy) return;
    const lx = mfx.value, ly = mfy.value;
    if ((!lx || !lx.trim()) && (!ly || !ly.trim())) return;

    answered = true;
    mfx.disabled = true;
    mfy.disabled = true;
    document.getElementById('check-btn').disabled = true;

    const q = currentQ;
    const correct = checkAnswer(lx, ly, q.x, q.y);
    record(correct);

    let html = '';
    if (!correct) {
        html += `<p style="margin-bottom:12px;text-align:center;">The correct answer is \\(x = ${q.x}\\), \\(y = ${q.y}\\).</p>`;
    }
    html += '<strong>Worked solution:</strong><br>';
    q.solution.forEach(s => { html += `<div class="solution-step">\\(${s}\\)</div>`; });
    showFeedback(correct, html);
}

function record(ok) {
    total++;
    if (ok) { score++; streak++; } else { streak = 0; }
    document.getElementById('score-display').textContent = `${score} / ${total}`;
    document.getElementById('pct-display').textContent = total ? Math.round(score/total*100) + '%' : '\u2014';
    document.getElementById('streak-display').textContent = streak;
}

function showFeedback(ok, html) {
    const fb = document.getElementById('feedback');
    fb.classList.remove('correct','incorrect');
    fb.classList.add('show', ok ? 'correct' : 'incorrect');
    document.getElementById('feedback-title').textContent = ok ? 'Correct!' : 'Not quite\u2026';
    document.getElementById('feedback-explanation').innerHTML = html;
    document.getElementById('next-btn').style.display = 'block';
    renderMath();
    fb.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

// ── Init ─────────────────────────────────────────────────────────
document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('rules-content').innerHTML = `
        <div class="rule-item">
            <span class="rule-name">Product Rule</span>
            \\(\\log_a(mn) = \\log_a(m) + \\log_a(n)\\)
        </div>
        <div class="rule-item">
            <span class="rule-name">Quotient Rule</span>
            \\(\\log_a\\!\\left(\\frac{m}{n}\\right) = \\log_a(m) - \\log_a(n)\\)
        </div>
        <div class="rule-item">
            <span class="rule-name">Power Rule</span>
            \\(\\log_a(m^k) = k \\cdot \\log_a(m)\\)
        </div>
        <div class="rule-item">
            <span class="rule-name">Definition</span>
            \\(\\log_a(x) = n \\iff a^n = x\\)
        </div>
        <div class="rule-item">
            <span class="rule-name">Strategy</span>
            Let \\(u = \\log_b(x)\\) and \\(v = \\log_b(y)\\), use log rules to
            rewrite as a linear system in \\(u\\) and \\(v\\), solve, then convert
            back: \\(x = b^u,\\; y = b^v\\).
        </div>`;

    renderMath();

    document.getElementById('check-btn').addEventListener('click', handleCheck);
    document.getElementById('next-btn').addEventListener('click', loadQuestion);

    setTimeout(() => {
        ['mf-x', 'mf-y'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.addEventListener('keydown', e => {
                if (e.key === 'Enter') { e.preventDefault(); handleCheck(); }
            });
        });
    }, 300);

    setTimeout(loadQuestion, 150);
});
</script>
</body>
</html>
