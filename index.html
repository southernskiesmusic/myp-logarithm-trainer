<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MYP Extended Maths Trainer</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <script type="module">import 'https://unpkg.com/mathlive?module';</script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<div id="app">

<!-- ==================== HUB VIEW ==================== -->
<div id="view-hub" class="view active">
    <div class="hub-header">
        <h1>MYP Extended Maths Trainer</h1>
        <p>Pick a topic to practise</p>
        <div class="last-updated" id="last-updated">Last updated: loading...</div>
    </div>
    <div class="topic-grid">
        <div class="topic-card" data-topic="logarithms">
            <h2>Logarithms</h2>
            <p>Log rules, identities, change of base, and simultaneous equations using logarithms.</p>
            <span class="topic-tag log">5 lessons + 3 activities</span>
        </div>
        <div class="topic-card" data-topic="quadratics">
            <h2>Quadratics</h2>
            <p>Expand, factorise, and work with quadratic expressions involving areas.</p>
            <span class="topic-tag quad">1 activity</span>
        </div>
        <div class="topic-card" data-topic="number">
            <h2>Number</h2>
            <p>Fractions, decimals, percentages, HCF/LCM, indices, standard form, surds, ratios.</p>
            <span class="topic-tag num">2 lessons + 6 activities</span>
        </div>
        <div class="topic-card" data-topic="algebra">
            <h2>Algebra</h2>
            <p>Expressions, linear equations, sequences, and inequalities.</p>
            <span class="topic-tag alg">4 activities</span>
        </div>
        <div class="topic-card" data-topic="functions">
            <h2>Functions & Graphs</h2>
            <p>Linear functions, quadratics, and graph transformations.</p>
            <span class="topic-tag func">3 activities</span>
        </div>
        <div class="topic-card" data-topic="criterion-b">
            <h2>Criterion B: Investigations</h2>
            <p>Guided pattern investigations for MYP assessment.</p>
            <span class="topic-tag crit-b">3 activities</span>
        </div>
    </div>
</div>

<!-- ==================== LOGARITHMS FOLDER VIEW ==================== -->
<div id="view-logarithms" class="view">
    <button class="back-btn" data-back="hub">All Topics</button>
    <header>
        <h1>Logarithms</h1>
        <p>Choose an activity</p>
    </header>
    <div class="topic-grid">
        <h3 class="section-label">Lessons</h3>
        <div class="topic-card lesson-card" data-lesson="log-intro">
            <h2>Introduction to Logarithms</h2>
            <p>Learn the definition, evaluation, and special values.</p>
            <span class="topic-tag lesson">Lesson</span>
        </div>
        <div class="topic-card lesson-card" data-lesson="log-rules-lesson">
            <h2>Log Rules</h2>
            <p>Product, quotient, and power rules with worked examples.</p>
            <span class="topic-tag lesson">Lesson</span>
        </div>
        <div class="topic-card lesson-card" data-lesson="log-natural">
            <h2>Common & Natural Logs</h2>
            <p>log, ln, and the change of base formula.</p>
            <span class="topic-tag lesson">Lesson</span>
        </div>
        <div class="topic-card lesson-card" data-lesson="log-expand">
            <h2>Expanding & Condensing</h2>
            <p>Use log rules to rewrite and simplify expressions.</p>
            <span class="topic-tag lesson">Lesson</span>
        </div>
        <div class="topic-card lesson-card" data-lesson="log-equations">
            <h2>Solving Log Equations</h2>
            <p>Solve logarithmic and exponential equations.</p>
            <span class="topic-tag lesson">Lesson</span>
        </div>
        <h3 class="section-label">Practice</h3>
        <div class="topic-card" data-topic="log-rules">
            <h2>Log Rules</h2>
            <p>Practise product, quotient, power, change of base, and identity rules.</p>
        </div>
        <div class="topic-card" data-topic="log-simul">
            <h2>Simultaneous Equations</h2>
            <p>Solve systems of equations using logarithm rules. Includes a scratchpad.</p>
        </div>
        <div class="topic-card" data-topic="log-mastery">
            <h2>Logarithm Mastery</h2>
            <p>Adaptive practice that tracks your progress across all log skills. Builds from basics to advanced.</p>
            <span class="topic-tag log">Adaptive</span>
        </div>
    </div>
</div>

<!-- ==================== LOG RULES VIEW ==================== -->
<div id="view-log-rules" class="view">
    <button class="back-btn" data-back="logarithms">Logarithms</button>
    <header>
        <h1>Log Rules Trainer</h1>
        <p>IB MYP Level &mdash; Master the laws of logarithms</p>
    </header>

    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="lr-score">0 / 0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value primary" id="lr-pct">&mdash;</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value success" id="lr-streak">0</div></div>
    </div>

    <div class="question-card" id="lr-card"><p style="color:var(--text-light)">Loading&hellip;</p></div>

    <details class="workout-section">
        <summary>Working Out</summary>
        <button class="copy-calc-btn" onclick="copyCalcToWorkout('lr-workout')">&#128203; Copy Calculator to Workings</button>
        <div class="workout-content" id="lr-workout" contenteditable="true"></div>
    </details>

    <div style="text-align:center;margin-bottom:16px;">
        <button class="btn btn-hint" id="lr-hint-btn">Hint</button>
    </div>
    <div class="hint-box" id="lr-hint"></div>

    <div class="feedback" id="lr-fb">
        <div class="feedback-title" id="lr-fb-title"></div>
        <div class="feedback-explanation" id="lr-fb-expl"></div>
    </div>

    <button class="btn btn-primary next-btn" id="lr-next">Next Question</button>

    <details class="rules-ref">
        <summary>Rules Reference</summary>
        <div class="rules-content" id="lr-ref"></div>
    </details>
</div>

<!-- ==================== SIMULTANEOUS VIEW ==================== -->
<div id="view-log-simul" class="view">
    <button class="back-btn" data-back="logarithms">Logarithms</button>
    <header>
        <h1>Log Simultaneous Equations</h1>
        <p>IB MYP Level &mdash; Solve systems using logarithm rules</p>
    </header>

    <div class="level-select" id="se-levels">
        <button class="level-btn active" data-level="all">All</button>
        <button class="level-btn" data-level="easy">Easy</button>
        <button class="level-btn" data-level="medium">Medium</button>
        <button class="level-btn" data-level="hard">Challenging</button>
    </div>

    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="se-score">0 / 0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value primary" id="se-pct">&mdash;</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value success" id="se-streak">0</div></div>
    </div>

    <div class="question-card" id="se-card"><p style="color:var(--text-light)">Loading&hellip;</p></div>

    <div style="text-align:center;margin-bottom:16px;">
        <button class="btn btn-hint" id="se-hint-btn">Hint</button>
    </div>
    <div class="hint-box" id="se-hint"></div>

    <div class="workout-section">
        <h3>Your Working</h3>
        <button class="copy-calc-btn" style="margin:0 0 12px;width:100%;" onclick="copyCalcToWorkout('se-workout')">&#128203; Copy Calculator to Workings</button>
        <div class="workout-content" id="se-workout" contenteditable="true" style="margin:0;width:100%;"></div>
    </div>

    <div class="answer-section">
        <h3>Your Answer</h3>
        <div class="answer-row">
            <span class="answer-label">\(x =\)</span>
            <math-field class="se-math-field" id="se-mf-x" placeholder="?"></math-field>
        </div>
        <div class="answer-row">
            <span class="answer-label">\(y =\)</span>
            <math-field class="se-math-field" id="se-mf-y" placeholder="?"></math-field>
        </div>
        <div class="btn-row">
            <button class="btn btn-primary" id="se-check">Check Answer</button>
        </div>
    </div>

    <div class="feedback" id="se-fb">
        <div class="feedback-title" id="se-fb-title"></div>
        <div class="feedback-explanation" id="se-fb-expl"></div>
    </div>

    <button class="btn btn-primary next-btn" id="se-next">Next Question</button>

    <details class="rules-ref">
        <summary>Reference</summary>
        <div class="rules-content" id="se-ref"></div>
    </details>
</div>

<!-- ==================== LOG MASTERY DASHBOARD VIEW ==================== -->
<div id="view-log-mastery" class="view">
    <button class="back-btn" data-back="logarithms">Logarithms</button>
    <header>
        <h1>Logarithm Mastery</h1>
        <p>Adaptive practice across all logarithm skills</p>
    </header>

    <div class="la-overall">
        <div class="la-overall-label">Overall Mastery: <strong id="la-overall-pct">0%</strong></div>
        <div class="la-overall-bar"><div class="la-overall-fill" id="la-overall-fill" style="width:0%"></div></div>
    </div>

    <div style="text-align:center;margin:20px 0;">
        <button class="btn btn-primary" id="la-start" style="padding:14px 40px;font-size:1.05rem;">Start Adaptive Practice</button>
        <button class="btn btn-hint" id="la-reset" style="margin-left:12px;font-size:0.82rem;">Reset Progress</button>
    </div>

    <div class="la-skills-grid" id="la-skills-grid"></div>

    <details class="rules-ref">
        <summary>Rules Reference</summary>
        <div class="rules-content" id="la-ref"></div>
    </details>
</div>

<!-- ==================== LOG MASTERY PRACTICE VIEW ==================== -->
<div id="view-log-mastery-practice" class="view">
    <button class="back-btn" id="la-back-btn">Mastery Dashboard</button>
    <header>
        <h1 id="la-practice-title">Adaptive Practice</h1>
        <p id="la-practice-subtitle">Practising your weakest skills</p>
    </header>

    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="la-score">0 / 0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value primary" id="la-pct">&mdash;</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value success" id="la-streak">0</div></div>
    </div>

    <div class="question-card" id="la-card"><p style="color:var(--text-light)">Loading&hellip;</p></div>

    <details class="workout-section">
        <summary>Working Out</summary>
        <button class="copy-calc-btn" onclick="copyCalcToWorkout('la-workout')">&#128203; Copy Calculator to Workings</button>
        <div class="workout-content" id="la-workout" contenteditable="true"></div>
    </details>

    <div style="text-align:center;margin-bottom:16px;">
        <button class="btn btn-hint" id="la-hint-btn">Hint</button>
    </div>
    <div class="hint-box" id="la-hint"></div>

    <div class="feedback" id="la-fb">
        <div class="feedback-title" id="la-fb-title"></div>
        <div class="feedback-explanation" id="la-fb-expl"></div>
    </div>

    <button class="btn btn-primary next-btn" id="la-next">Next Question</button>

    <details class="rules-ref">
        <summary>Rules Reference</summary>
        <div class="rules-content" id="la-ref2"></div>
    </details>
</div>

<!-- ==================== QUADRATICS FOLDER VIEW ==================== -->
<div id="view-quadratics" class="view">
    <button class="back-btn" data-back="hub">All Topics</button>
    <header>
        <h1>Quadratics</h1>
        <p>Choose an activity</p>
    </header>
    <div class="topic-grid">
        <div class="topic-card" data-topic="quad-areas">
            <h2>Expressions &amp; Areas</h2>
            <p>Expand and factorise quadratic expressions using areas of shapes.</p>
        </div>
    </div>
</div>

<!-- ==================== QUADRATIC AREAS VIEW ==================== -->
<div id="view-quad-areas" class="view">
    <button class="back-btn" data-back="quadratics">Quadratics</button>
    <header>
        <h1>Quadratic Expressions &amp; Areas</h1>
        <p>IB MYP Level &mdash; Expand and factorise using areas</p>
    </header>

    <div class="level-select" id="qa-levels">
        <button class="level-btn active" data-level="all">All</button>
        <button class="level-btn" data-level="easy">Easy</button>
        <button class="level-btn" data-level="medium">Medium</button>
        <button class="level-btn" data-level="hard">Challenging</button>
    </div>

    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="qa-score">0 / 0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value primary" id="qa-pct">&mdash;</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value success" id="qa-streak">0</div></div>
    </div>

    <div class="question-card" id="qa-card"><p style="color:var(--text-light)">Loading&hellip;</p></div>

    <details class="workout-section">
        <summary>Working Out</summary>
        <button class="copy-calc-btn" onclick="copyCalcToWorkout('qa-workout')">&#128203; Copy Calculator to Workings</button>
        <div class="workout-content" id="qa-workout" contenteditable="true"></div>
    </details>

    <div style="text-align:center;margin-bottom:16px;">
        <button class="btn btn-hint" id="qa-hint-btn">Hint</button>
    </div>
    <div class="hint-box" id="qa-hint"></div>

    <div class="feedback" id="qa-fb">
        <div class="feedback-title" id="qa-fb-title"></div>
        <div class="feedback-explanation" id="qa-fb-expl"></div>
    </div>

    <button class="btn btn-primary next-btn" id="qa-next">Next Question</button>

    <details class="rules-ref">
        <summary>Rules Reference</summary>
        <div class="rules-content" id="qa-ref"></div>
    </details>
</div>

<!-- ==================== NUMBER FOLDER VIEW ==================== -->
<div id="view-number" class="view">
    <button class="back-btn" data-back="hub">All Topics</button>
    <header>
        <h1>Number</h1>
        <p>Choose an activity</p>
    </header>
    <div class="topic-grid">
        <h3 class="section-label">Lessons</h3>
        <div class="topic-card lesson-card" data-lesson="indices">
            <h2>Indices</h2>
            <p>Learn the laws of indices and fractional powers.</p>
            <span class="topic-tag lesson">Lesson</span>
        </div>
        <div class="topic-card lesson-card" data-lesson="surds">
            <h2>Surds</h2>
            <p>Learn to simplify surds, add/subtract, and rationalise.</p>
            <span class="topic-tag lesson">Lesson</span>
        </div>
        <h3 class="section-label">Practice</h3>
        <div class="topic-card" data-topic="num-fdp">
            <h2>Fractions, Decimals &amp; Percentages</h2>
            <p>Convert between forms, operations, percentage increase/decrease.</p>
        </div>
        <div class="topic-card" data-topic="num-hcflcm">
            <h2>HCF &amp; LCM</h2>
            <p>Find highest common factor and lowest common multiple.</p>
        </div>
        <div class="topic-card" data-topic="num-indices">
            <h2>Indices</h2>
            <p>Laws of indices with integer, negative, and fractional powers.</p>
        </div>
        <div class="topic-card" data-topic="num-stdform">
            <h2>Standard Form</h2>
            <p>Convert to/from standard form, calculations.</p>
        </div>
        <div class="topic-card" data-topic="num-surds">
            <h2>Surds</h2>
            <p>Simplify, rationalise denominators, operations with surds.</p>
        </div>
        <div class="topic-card" data-topic="num-ratio">
            <h2>Ratios &amp; Proportion</h2>
            <p>Simplify ratios, share in ratio, direct and inverse proportion.</p>
        </div>
    </div>
</div>

<!-- ==================== FRACTIONS DECIMALS PERCENTAGES VIEW ==================== -->
<div id="view-num-fdp" class="view">
    <button class="back-btn" data-back="number">Number</button>
    <header>
        <h1>Fractions, Decimals &amp; Percentages</h1>
        <p>IB MYP Level</p>
    </header>
    <div class="level-select" id="fdp-levels">
        <button class="level-btn active" data-level="all">All</button>
        <button class="level-btn" data-level="easy">Easy</button>
        <button class="level-btn" data-level="medium">Medium</button>
        <button class="level-btn" data-level="hard">Challenging</button>
    </div>
    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="fdp-score">0 / 0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value primary" id="fdp-pct">&mdash;</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value success" id="fdp-streak">0</div></div>
    </div>
    <div class="question-card" id="fdp-card"><p style="color:var(--text-light)">Loading&hellip;</p></div>
    <details class="workout-section"><summary>Working Out</summary><button class="copy-calc-btn" onclick="copyCalcToWorkout('fdp-workout')">&#128203; Copy Calculator to Workings</button><div class="workout-content" id="fdp-workout" contenteditable="true"></div></details>
    <div style="text-align:center;margin-bottom:16px;"><button class="btn btn-hint" id="fdp-hint-btn">Hint</button></div>
    <div class="hint-box" id="fdp-hint"></div>
    <div class="feedback" id="fdp-fb"><div class="feedback-title" id="fdp-fb-title"></div><div class="feedback-explanation" id="fdp-fb-expl"></div></div>
    <button class="btn btn-primary next-btn" id="fdp-next">Next Question</button>
    <details class="rules-ref"><summary>Rules Reference</summary><div class="rules-content" id="fdp-ref"></div></details>
</div>

<!-- ==================== HCF LCM VIEW ==================== -->
<div id="view-num-hcflcm" class="view">
    <button class="back-btn" data-back="number">Number</button>
    <header>
        <h1>HCF &amp; LCM</h1>
        <p>IB MYP Level</p>
    </header>
    <div class="level-select" id="hcflcm-levels">
        <button class="level-btn active" data-level="all">All</button>
        <button class="level-btn" data-level="easy">Easy</button>
        <button class="level-btn" data-level="medium">Medium</button>
        <button class="level-btn" data-level="hard">Challenging</button>
    </div>
    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="hcflcm-score">0 / 0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value primary" id="hcflcm-pct">&mdash;</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value success" id="hcflcm-streak">0</div></div>
    </div>
    <div class="question-card" id="hcflcm-card"><p style="color:var(--text-light)">Loading&hellip;</p></div>
    <details class="workout-section"><summary>Working Out</summary><button class="copy-calc-btn" onclick="copyCalcToWorkout('hcflcm-workout')">&#128203; Copy Calculator to Workings</button><div class="workout-content" id="hcflcm-workout" contenteditable="true"></div></details>
    <div style="text-align:center;margin-bottom:16px;"><button class="btn btn-hint" id="hcflcm-hint-btn">Hint</button></div>
    <div class="hint-box" id="hcflcm-hint"></div>
    <div class="feedback" id="hcflcm-fb"><div class="feedback-title" id="hcflcm-fb-title"></div><div class="feedback-explanation" id="hcflcm-fb-expl"></div></div>
    <button class="btn btn-primary next-btn" id="hcflcm-next">Next Question</button>
    <details class="rules-ref"><summary>Rules Reference</summary><div class="rules-content" id="hcflcm-ref"></div></details>
</div>

<!-- ==================== INDICES VIEW ==================== -->
<div id="view-num-indices" class="view">
    <button class="back-btn" data-back="number">Number</button>
    <header>
        <h1>Indices</h1>
        <p>IB MYP Level</p>
    </header>
    <div class="level-select" id="idx-levels">
        <button class="level-btn active" data-level="all">All</button>
        <button class="level-btn" data-level="easy">Easy</button>
        <button class="level-btn" data-level="medium">Medium</button>
        <button class="level-btn" data-level="hard">Challenging</button>
    </div>
    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="idx-score">0 / 0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value primary" id="idx-pct">&mdash;</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value success" id="idx-streak">0</div></div>
    </div>
    <div class="question-card" id="idx-card"><p style="color:var(--text-light)">Loading&hellip;</p></div>
    <details class="workout-section"><summary>Working Out</summary><button class="copy-calc-btn" onclick="copyCalcToWorkout('idx-workout')">&#128203; Copy Calculator to Workings</button><div class="workout-content" id="idx-workout" contenteditable="true"></div></details>
    <div style="text-align:center;margin-bottom:16px;"><button class="btn btn-hint" id="idx-hint-btn">Hint</button></div>
    <div class="hint-box" id="idx-hint"></div>
    <div class="feedback" id="idx-fb"><div class="feedback-title" id="idx-fb-title"></div><div class="feedback-explanation" id="idx-fb-expl"></div></div>
    <button class="btn btn-primary next-btn" id="idx-next">Next Question</button>
    <details class="rules-ref"><summary>Rules Reference</summary><div class="rules-content" id="idx-ref"></div></details>
</div>

<!-- ==================== STANDARD FORM VIEW ==================== -->
<div id="view-num-stdform" class="view">
    <button class="back-btn" data-back="number">Number</button>
    <header>
        <h1>Standard Form</h1>
        <p>IB MYP Level</p>
    </header>
    <div class="level-select" id="sf-levels">
        <button class="level-btn active" data-level="all">All</button>
        <button class="level-btn" data-level="easy">Easy</button>
        <button class="level-btn" data-level="medium">Medium</button>
        <button class="level-btn" data-level="hard">Challenging</button>
    </div>
    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="sf-score">0 / 0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value primary" id="sf-pct">&mdash;</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value success" id="sf-streak">0</div></div>
    </div>
    <div class="question-card" id="sf-card"><p style="color:var(--text-light)">Loading&hellip;</p></div>
    <details class="workout-section"><summary>Working Out</summary><button class="copy-calc-btn" onclick="copyCalcToWorkout('sf-workout')">&#128203; Copy Calculator to Workings</button><div class="workout-content" id="sf-workout" contenteditable="true"></div></details>
    <div style="text-align:center;margin-bottom:16px;"><button class="btn btn-hint" id="sf-hint-btn">Hint</button></div>
    <div class="hint-box" id="sf-hint"></div>
    <div class="feedback" id="sf-fb"><div class="feedback-title" id="sf-fb-title"></div><div class="feedback-explanation" id="sf-fb-expl"></div></div>
    <button class="btn btn-primary next-btn" id="sf-next">Next Question</button>
    <details class="rules-ref"><summary>Rules Reference</summary><div class="rules-content" id="sf-ref"></div></details>
</div>

<!-- ==================== SURDS VIEW ==================== -->
<div id="view-num-surds" class="view">
    <button class="back-btn" data-back="number">Number</button>
    <header>
        <h1>Surds</h1>
        <p>IB MYP Level</p>
    </header>
    <div class="level-select" id="surd-levels">
        <button class="level-btn active" data-level="all">All</button>
        <button class="level-btn" data-level="easy">Easy</button>
        <button class="level-btn" data-level="medium">Medium</button>
        <button class="level-btn" data-level="hard">Challenging</button>
    </div>
    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="surd-score">0 / 0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value primary" id="surd-pct">&mdash;</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value success" id="surd-streak">0</div></div>
    </div>
    <div class="question-card" id="surd-card"><p style="color:var(--text-light)">Loading&hellip;</p></div>
    <details class="workout-section"><summary>Working Out</summary><button class="copy-calc-btn" onclick="copyCalcToWorkout('surd-workout')">&#128203; Copy Calculator to Workings</button><div class="workout-content" id="surd-workout" contenteditable="true"></div></details>
    <div style="text-align:center;margin-bottom:16px;"><button class="btn btn-hint" id="surd-hint-btn">Hint</button></div>
    <div class="hint-box" id="surd-hint"></div>
    <div class="feedback" id="surd-fb"><div class="feedback-title" id="surd-fb-title"></div><div class="feedback-explanation" id="surd-fb-expl"></div></div>
    <button class="btn btn-primary next-btn" id="surd-next">Next Question</button>
    <details class="rules-ref"><summary>Rules Reference</summary><div class="rules-content" id="surd-ref"></div></details>
</div>

<!-- ==================== RATIO VIEW ==================== -->
<div id="view-num-ratio" class="view">
    <button class="back-btn" data-back="number">Number</button>
    <header>
        <h1>Ratios &amp; Proportion</h1>
        <p>IB MYP Level</p>
    </header>
    <div class="level-select" id="ratio-levels">
        <button class="level-btn active" data-level="all">All</button>
        <button class="level-btn" data-level="easy">Easy</button>
        <button class="level-btn" data-level="medium">Medium</button>
        <button class="level-btn" data-level="hard">Challenging</button>
    </div>
    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="ratio-score">0 / 0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value primary" id="ratio-pct">&mdash;</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value success" id="ratio-streak">0</div></div>
    </div>
    <div class="question-card" id="ratio-card"><p style="color:var(--text-light)">Loading&hellip;</p></div>
    <details class="workout-section"><summary>Working Out</summary><button class="copy-calc-btn" onclick="copyCalcToWorkout('ratio-workout')">&#128203; Copy Calculator to Workings</button><div class="workout-content" id="ratio-workout" contenteditable="true"></div></details>
    <div style="text-align:center;margin-bottom:16px;"><button class="btn btn-hint" id="ratio-hint-btn">Hint</button></div>
    <div class="hint-box" id="ratio-hint"></div>
    <div class="feedback" id="ratio-fb"><div class="feedback-title" id="ratio-fb-title"></div><div class="feedback-explanation" id="ratio-fb-expl"></div></div>
    <button class="btn btn-primary next-btn" id="ratio-next">Next Question</button>
    <details class="rules-ref"><summary>Rules Reference</summary><div class="rules-content" id="ratio-ref"></div></details>
</div>

<!-- ==================== ALGEBRA FOLDER VIEW ==================== -->
<div id="view-algebra" class="view">
    <button class="back-btn" data-back="hub">All Topics</button>
    <header>
        <h1>Algebra</h1>
        <p>Choose an activity</p>
    </header>
    <div class="topic-grid">
        <div class="topic-card" data-topic="alg-expr">
            <h2>Expressions</h2>
            <p>Simplify, expand brackets, and factorise algebraic expressions.</p>
        </div>
        <div class="topic-card" data-topic="alg-linear">
            <h2>Linear Equations</h2>
            <p>Solve one-step, two-step, and equations with brackets.</p>
        </div>
        <div class="topic-card" data-topic="alg-seq">
            <h2>Sequences</h2>
            <p>Arithmetic and geometric sequences, find the nth term.</p>
        </div>
        <div class="topic-card" data-topic="alg-ineq">
            <h2>Inequalities</h2>
            <p>Solve and represent linear inequalities.</p>
        </div>
    </div>
</div>

<!-- ==================== EXPRESSIONS VIEW ==================== -->
<div id="view-alg-expr" class="view">
    <button class="back-btn" data-back="algebra">Algebra</button>
    <header>
        <h1>Algebraic Expressions</h1>
        <p>IB MYP Level</p>
    </header>
    <div class="level-select" id="expr-levels">
        <button class="level-btn active" data-level="all">All</button>
        <button class="level-btn" data-level="easy">Easy</button>
        <button class="level-btn" data-level="medium">Medium</button>
        <button class="level-btn" data-level="hard">Challenging</button>
    </div>
    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="expr-score">0 / 0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value primary" id="expr-pct">&mdash;</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value success" id="expr-streak">0</div></div>
    </div>
    <div class="question-card" id="expr-card"><p style="color:var(--text-light)">Loading&hellip;</p></div>
    <details class="workout-section"><summary>Working Out</summary><button class="copy-calc-btn" onclick="copyCalcToWorkout('expr-workout')">&#128203; Copy Calculator to Workings</button><div class="workout-content" id="expr-workout" contenteditable="true"></div></details>
    <div style="text-align:center;margin-bottom:16px;"><button class="btn btn-hint" id="expr-hint-btn">Hint</button></div>
    <div class="hint-box" id="expr-hint"></div>
    <div class="feedback" id="expr-fb"><div class="feedback-title" id="expr-fb-title"></div><div class="feedback-explanation" id="expr-fb-expl"></div></div>
    <button class="btn btn-primary next-btn" id="expr-next">Next Question</button>
    <details class="rules-ref"><summary>Rules Reference</summary><div class="rules-content" id="expr-ref"></div></details>
</div>

<!-- ==================== LINEAR EQUATIONS VIEW ==================== -->
<div id="view-alg-linear" class="view">
    <button class="back-btn" data-back="algebra">Algebra</button>
    <header>
        <h1>Linear Equations</h1>
        <p>IB MYP Level</p>
    </header>
    <div class="level-select" id="linear-levels">
        <button class="level-btn active" data-level="all">All</button>
        <button class="level-btn" data-level="easy">Easy</button>
        <button class="level-btn" data-level="medium">Medium</button>
        <button class="level-btn" data-level="hard">Challenging</button>
    </div>
    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="linear-score">0 / 0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value primary" id="linear-pct">&mdash;</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value success" id="linear-streak">0</div></div>
    </div>
    <div class="question-card" id="linear-card"><p style="color:var(--text-light)">Loading&hellip;</p></div>
    <details class="workout-section"><summary>Working Out</summary><button class="copy-calc-btn" onclick="copyCalcToWorkout('linear-workout')">&#128203; Copy Calculator to Workings</button><div class="workout-content" id="linear-workout" contenteditable="true"></div></details>
    <div style="text-align:center;margin-bottom:16px;"><button class="btn btn-hint" id="linear-hint-btn">Hint</button></div>
    <div class="hint-box" id="linear-hint"></div>
    <div class="feedback" id="linear-fb"><div class="feedback-title" id="linear-fb-title"></div><div class="feedback-explanation" id="linear-fb-expl"></div></div>
    <button class="btn btn-primary next-btn" id="linear-next">Next Question</button>
    <details class="rules-ref"><summary>Rules Reference</summary><div class="rules-content" id="linear-ref"></div></details>
</div>

<!-- ==================== SEQUENCES VIEW ==================== -->
<div id="view-alg-seq" class="view">
    <button class="back-btn" data-back="algebra">Algebra</button>
    <header>
        <h1>Sequences</h1>
        <p>IB MYP Level</p>
    </header>
    <div class="level-select" id="seq-levels">
        <button class="level-btn active" data-level="all">All</button>
        <button class="level-btn" data-level="easy">Easy</button>
        <button class="level-btn" data-level="medium">Medium</button>
        <button class="level-btn" data-level="hard">Challenging</button>
    </div>
    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="seq-score">0 / 0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value primary" id="seq-pct">&mdash;</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value success" id="seq-streak">0</div></div>
    </div>
    <div class="question-card" id="seq-card"><p style="color:var(--text-light)">Loading&hellip;</p></div>
    <details class="workout-section"><summary>Working Out</summary><button class="copy-calc-btn" onclick="copyCalcToWorkout('seq-workout')">&#128203; Copy Calculator to Workings</button><div class="workout-content" id="seq-workout" contenteditable="true"></div></details>
    <div style="text-align:center;margin-bottom:16px;"><button class="btn btn-hint" id="seq-hint-btn">Hint</button></div>
    <div class="hint-box" id="seq-hint"></div>
    <div class="feedback" id="seq-fb"><div class="feedback-title" id="seq-fb-title"></div><div class="feedback-explanation" id="seq-fb-expl"></div></div>
    <button class="btn btn-primary next-btn" id="seq-next">Next Question</button>
    <details class="rules-ref"><summary>Rules Reference</summary><div class="rules-content" id="seq-ref"></div></details>
</div>

<!-- ==================== INEQUALITIES VIEW ==================== -->
<div id="view-alg-ineq" class="view">
    <button class="back-btn" data-back="algebra">Algebra</button>
    <header>
        <h1>Inequalities</h1>
        <p>IB MYP Level</p>
    </header>
    <div class="level-select" id="ineq-levels">
        <button class="level-btn active" data-level="all">All</button>
        <button class="level-btn" data-level="easy">Easy</button>
        <button class="level-btn" data-level="medium">Medium</button>
        <button class="level-btn" data-level="hard">Challenging</button>
    </div>
    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="ineq-score">0 / 0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value primary" id="ineq-pct">&mdash;</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value success" id="ineq-streak">0</div></div>
    </div>
    <div class="question-card" id="ineq-card"><p style="color:var(--text-light)">Loading&hellip;</p></div>
    <details class="workout-section"><summary>Working Out</summary><button class="copy-calc-btn" onclick="copyCalcToWorkout('ineq-workout')">&#128203; Copy Calculator to Workings</button><div class="workout-content" id="ineq-workout" contenteditable="true"></div></details>
    <div style="text-align:center;margin-bottom:16px;"><button class="btn btn-hint" id="ineq-hint-btn">Hint</button></div>
    <div class="hint-box" id="ineq-hint"></div>
    <div class="feedback" id="ineq-fb"><div class="feedback-title" id="ineq-fb-title"></div><div class="feedback-explanation" id="ineq-fb-expl"></div></div>
    <button class="btn btn-primary next-btn" id="ineq-next">Next Question</button>
    <details class="rules-ref"><summary>Rules Reference</summary><div class="rules-content" id="ineq-ref"></div></details>
</div>

<!-- ==================== FUNCTIONS FOLDER VIEW ==================== -->
<div id="view-functions" class="view">
    <button class="back-btn" data-back="hub">All Topics</button>
    <header>
        <h1>Functions & Graphs</h1>
        <p>Choose an activity</p>
    </header>
    <div class="topic-grid">
        <div class="topic-card" data-topic="func-linear">
            <h2>Linear Functions</h2>
            <p>Gradient, y-intercept, equations of lines, parallel and perpendicular.</p>
        </div>
        <div class="topic-card" data-topic="func-quadratic">
            <h2>Quadratic Functions</h2>
            <p>Vertex, roots, axis of symmetry, sketching parabolas.</p>
        </div>
        <div class="topic-card" data-topic="func-transform">
            <h2>Graph Transformations</h2>
            <p>Translations, reflections, and stretches of functions.</p>
        </div>
    </div>
</div>

<!-- ==================== LINEAR FUNCTIONS VIEW ==================== -->
<div id="view-func-linear" class="view">
    <button class="back-btn" data-back="functions">Functions & Graphs</button>
    <header>
        <h1>Linear Functions</h1>
        <p>IB MYP Level</p>
    </header>
    <div class="level-select" id="linf-levels">
        <button class="level-btn active" data-level="all">All</button>
        <button class="level-btn" data-level="easy">Easy</button>
        <button class="level-btn" data-level="medium">Medium</button>
        <button class="level-btn" data-level="hard">Challenging</button>
    </div>
    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="linf-score">0 / 0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value primary" id="linf-pct">&mdash;</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value success" id="linf-streak">0</div></div>
    </div>
    <div class="question-card" id="linf-card"><p style="color:var(--text-light)">Loading&hellip;</p></div>
    <details class="workout-section"><summary>Working Out</summary><button class="copy-calc-btn" onclick="copyCalcToWorkout('linf-workout')">&#128203; Copy Calculator to Workings</button><div class="workout-content" id="linf-workout" contenteditable="true"></div></details>
    <div style="text-align:center;margin-bottom:16px;"><button class="btn btn-hint" id="linf-hint-btn">Hint</button></div>
    <div class="hint-box" id="linf-hint"></div>
    <div class="feedback" id="linf-fb"><div class="feedback-title" id="linf-fb-title"></div><div class="feedback-explanation" id="linf-fb-expl"></div></div>
    <button class="btn btn-primary next-btn" id="linf-next">Next Question</button>
    <details class="rules-ref"><summary>Rules Reference</summary><div class="rules-content" id="linf-ref"></div></details>
</div>

<!-- ==================== QUADRATIC FUNCTIONS VIEW ==================== -->
<div id="view-func-quadratic" class="view">
    <button class="back-btn" data-back="functions">Functions & Graphs</button>
    <header>
        <h1>Quadratic Functions</h1>
        <p>IB MYP Level</p>
    </header>
    <div class="level-select" id="quadf-levels">
        <button class="level-btn active" data-level="all">All</button>
        <button class="level-btn" data-level="easy">Easy</button>
        <button class="level-btn" data-level="medium">Medium</button>
        <button class="level-btn" data-level="hard">Challenging</button>
    </div>
    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="quadf-score">0 / 0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value primary" id="quadf-pct">&mdash;</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value success" id="quadf-streak">0</div></div>
    </div>
    <div class="question-card" id="quadf-card"><p style="color:var(--text-light)">Loading&hellip;</p></div>
    <details class="workout-section"><summary>Working Out</summary><button class="copy-calc-btn" onclick="copyCalcToWorkout('quadf-workout')">&#128203; Copy Calculator to Workings</button><div class="workout-content" id="quadf-workout" contenteditable="true"></div></details>
    <div style="text-align:center;margin-bottom:16px;"><button class="btn btn-hint" id="quadf-hint-btn">Hint</button></div>
    <div class="hint-box" id="quadf-hint"></div>
    <div class="feedback" id="quadf-fb"><div class="feedback-title" id="quadf-fb-title"></div><div class="feedback-explanation" id="quadf-fb-expl"></div></div>
    <button class="btn btn-primary next-btn" id="quadf-next">Next Question</button>
    <details class="rules-ref"><summary>Rules Reference</summary><div class="rules-content" id="quadf-ref"></div></details>
</div>

<!-- ==================== GRAPH TRANSFORMATIONS VIEW ==================== -->
<div id="view-func-transform" class="view">
    <button class="back-btn" data-back="functions">Functions & Graphs</button>
    <header>
        <h1>Graph Transformations</h1>
        <p>IB MYP Level</p>
    </header>
    <div class="level-select" id="trans-levels">
        <button class="level-btn active" data-level="all">All</button>
        <button class="level-btn" data-level="easy">Easy</button>
        <button class="level-btn" data-level="medium">Medium</button>
        <button class="level-btn" data-level="hard">Challenging</button>
    </div>
    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="trans-score">0 / 0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value primary" id="trans-pct">&mdash;</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value success" id="trans-streak">0</div></div>
    </div>
    <div class="question-card" id="trans-card"><p style="color:var(--text-light)">Loading&hellip;</p></div>
    <details class="workout-section"><summary>Working Out</summary><button class="copy-calc-btn" onclick="copyCalcToWorkout('trans-workout')">&#128203; Copy Calculator to Workings</button><div class="workout-content" id="trans-workout" contenteditable="true"></div></details>
    <div style="text-align:center;margin-bottom:16px;"><button class="btn btn-hint" id="trans-hint-btn">Hint</button></div>
    <div class="hint-box" id="trans-hint"></div>
    <div class="feedback" id="trans-fb"><div class="feedback-title" id="trans-fb-title"></div><div class="feedback-explanation" id="trans-fb-expl"></div></div>
    <button class="btn btn-primary next-btn" id="trans-next">Next Question</button>
    <details class="rules-ref"><summary>Rules Reference</summary><div class="rules-content" id="trans-ref"></div></details>
</div>

<!-- ==================== CRITERION B FOLDER VIEW ==================== -->
<div id="view-criterion-b" class="view">
    <button class="back-btn" data-back="hub">All Topics</button>
    <header>
        <h1>Criterion B: Investigations</h1>
        <p>Guided pattern investigations</p>
    </header>
    <div class="topic-grid">
        <div class="topic-card" data-topic="crit-matchstick">
            <h2>Matchstick Patterns</h2>
            <p>Investigate patterns in geometric shapes made from matchsticks.</p>
        </div>
        <div class="topic-card" data-topic="crit-number">
            <h2>Number Sums</h2>
            <p>Discover patterns in sums of consecutive numbers.</p>
        </div>
        <div class="topic-card" data-topic="crit-dots">
            <h2>Dot Patterns</h2>
            <p>Explore triangular, square, and other figurate numbers.</p>
        </div>
    </div>
</div>

<!-- ==================== MATCHSTICK PATTERNS INVESTIGATION ==================== -->
<div id="view-crit-matchstick" class="view">
    <button class="back-btn" data-back="criterion-b">Criterion B</button>
    <header>
        <h1>Matchstick Patterns</h1>
        <p>Investigation</p>
    </header>
    <div class="score-bar">
        <div class="score-item"><div class="label">Progress</div><div class="value primary" id="match-progress">0 / 6</div></div>
        <div class="score-item"><div class="label">Correct</div><div class="value success" id="match-correct">0</div></div>
    </div>
    <div class="question-card" id="match-card"><p style="color:var(--text-light)">Loading&hellip;</p></div>
    <details class="workout-section"><summary>Working Out</summary><button class="copy-calc-btn" onclick="copyCalcToWorkout('match-workout')">&#128203; Copy Calculator to Workings</button><div class="workout-content" id="match-workout" contenteditable="true"></div></details>
    <div style="text-align:center;margin-bottom:16px;"><button class="btn btn-hint" id="match-hint-btn">Hint</button></div>
    <div class="hint-box" id="match-hint"></div>
    <div class="feedback" id="match-fb"><div class="feedback-title" id="match-fb-title"></div><div class="feedback-explanation" id="match-fb-expl"></div></div>
    <button class="btn btn-primary next-btn" id="match-next">Next Question</button>
</div>

<!-- ==================== NUMBER SUMS INVESTIGATION ==================== -->
<div id="view-crit-number" class="view">
    <button class="back-btn" data-back="criterion-b">Criterion B</button>
    <header>
        <h1>Number Sums</h1>
        <p>Investigation</p>
    </header>
    <div class="score-bar">
        <div class="score-item"><div class="label">Progress</div><div class="value primary" id="numsum-progress">0 / 6</div></div>
        <div class="score-item"><div class="label">Correct</div><div class="value success" id="numsum-correct">0</div></div>
    </div>
    <div class="question-card" id="numsum-card"><p style="color:var(--text-light)">Loading&hellip;</p></div>
    <details class="workout-section"><summary>Working Out</summary><button class="copy-calc-btn" onclick="copyCalcToWorkout('numsum-workout')">&#128203; Copy Calculator to Workings</button><div class="workout-content" id="numsum-workout" contenteditable="true"></div></details>
    <div style="text-align:center;margin-bottom:16px;"><button class="btn btn-hint" id="numsum-hint-btn">Hint</button></div>
    <div class="hint-box" id="numsum-hint"></div>
    <div class="feedback" id="numsum-fb"><div class="feedback-title" id="numsum-fb-title"></div><div class="feedback-explanation" id="numsum-fb-expl"></div></div>
    <button class="btn btn-primary next-btn" id="numsum-next">Next Question</button>
</div>

<!-- ==================== DOT PATTERNS INVESTIGATION ==================== -->
<div id="view-crit-dots" class="view">
    <button class="back-btn" data-back="criterion-b">Criterion B</button>
    <header>
        <h1>Dot Patterns</h1>
        <p>Investigation</p>
    </header>
    <div class="score-bar">
        <div class="score-item"><div class="label">Progress</div><div class="value primary" id="dots-progress">0 / 6</div></div>
        <div class="score-item"><div class="label">Correct</div><div class="value success" id="dots-correct">0</div></div>
    </div>
    <div class="question-card" id="dots-card"><p style="color:var(--text-light)">Loading&hellip;</p></div>
    <details class="workout-section"><summary>Working Out</summary><button class="copy-calc-btn" onclick="copyCalcToWorkout('dots-workout')">&#128203; Copy Calculator to Workings</button><div class="workout-content" id="dots-workout" contenteditable="true"></div></details>
    <div style="text-align:center;margin-bottom:16px;"><button class="btn btn-hint" id="dots-hint-btn">Hint</button></div>
    <div class="hint-box" id="dots-hint"></div>
    <div class="feedback" id="dots-fb"><div class="feedback-title" id="dots-fb-title"></div><div class="feedback-explanation" id="dots-fb-expl"></div></div>
    <button class="btn btn-primary next-btn" id="dots-next">Next Question</button>
</div>

<!-- ==================== LESSON VIEW (reusable) ==================== -->
<div id="view-lesson" class="view">
    <button class="back-btn" id="lesson-back-btn">Back</button>
    <header>
        <h1 id="lesson-title"></h1>
        <p id="lesson-subtitle"></p>
    </header>
    <div class="lesson-progress"><div class="lesson-progress-fill" id="lesson-progress-fill"></div></div>
    <div class="lesson-content" id="lesson-content"></div>
    <div class="lesson-nav" id="lesson-nav"></div>
</div>

<!-- Calculator -->
<button class="calc-btn" id="calc-btn" title="Calculator">&#129518;</button>
<div class="calc-modal" id="calc-modal">
    <div class="calc-container" id="calc-container"></div>
</div>
<script src="https://www.desmos.com/api/v1.9/calculator.js?apiKey=dcb31709b452b1cf9dc26972add0fda6"></script>

</div><!-- /app -->

<!-- ==================== SCRIPTS ==================== -->
<!-- 1. Shared utilities (must load first) -->
<script src="js/utils.js"></script>

<!-- 2. Trainers (order independent) -->
<script src="js/trainers/lr.js"></script>
<script src="js/trainers/la.js"></script>
<script src="js/trainers/se.js"></script>
<script src="js/trainers/qa.js"></script>
<script src="js/trainers/fdp.js"></script>
<script src="js/trainers/hcflcm.js"></script>
<script src="js/trainers/idx.js"></script>
<script src="js/trainers/sf.js"></script>
<script src="js/trainers/surd.js"></script>
<script src="js/trainers/ratio.js"></script>
<script src="js/trainers/expr.js"></script>
<script src="js/trainers/linear.js"></script>
<script src="js/trainers/seq.js"></script>
<script src="js/trainers/ineq.js"></script>
<script src="js/trainers/linf.js"></script>
<script src="js/trainers/quadf.js"></script>
<script src="js/trainers/trans.js"></script>
<script src="js/trainers/match.js"></script>
<script src="js/trainers/numsum.js"></script>
<script src="js/trainers/dots.js"></script>

<!-- 3. Lesson engine + lesson data -->
<script src="js/lessons/lesson-engine.js"></script>
<script src="js/lessons/log-intro.js"></script>
<script src="js/lessons/log-rules.js"></script>
<script src="js/lessons/log-natural.js"></script>
<script src="js/lessons/log-expand.js"></script>
<script src="js/lessons/log-equations.js"></script>
<script src="js/lessons/indices.js"></script>
<script src="js/lessons/surds.js"></script>

<!-- 4. Init (must load LAST) -->
<script src="js/init.js"></script>
</body>
</html>
